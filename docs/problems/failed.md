# 为什么我的作业失败了？

:::tip TL;DR

通过日志与诊断功能，可以明白大多数作业失败的原因。最常见的原因有两种：

1. 命令无法运行，比如找不到依赖、缺少数据集等；
2. 内存不足，运行过程中 Out of Memory。

:::

## 1. 有哪些手段可以用来诊断作业失败的原因？

### 1.1. 查看日志

在「我的作业」页面，点击作业名称，可以查看作业的统计信息、基本信息等详细信息，如果您的作业已经失败，那么查看日志可能格外有用。

首先切换到基本信息选项卡，每个作业都会由一个或者多个容器实际执行，这里正显示了这些容器的各种信息。点击「查看日志」按钮，可以查看容器的日志。

![查看日志](./img/detail.png)

日志窗口包含两部分：左边是具体的日志内容，默认会显示最近的 500 条日志，如果是交互式任务，则这里显示的是 Jupyter 服务器的日志，可能无法为您提供太多诊断上的帮助；如果是批处理作业，则这里显示的是作业的日志，可以帮助您找到作业失败的原因。

例如，某个失败的批处理作业的日志如下所示，可以看到作业失败的原因是找不到某个文件：

![日志](./img/custom_log.png)

而在日志窗口的右侧，会显示退出的代码。如果是程序问题导致的退出，那么退出代码一般是 1，比如上图就是 1。如果这个作业顺利完成，那么退出代码一般是 0。

那么有没有退出代码是 1 以外的情况呢？有一些特殊情况，比如内存不足导致的退出，这种情况下退出代码是 137。

![内存不足](./img/log.png)

### 1.2 查看作业的统计信息

有些情况下，你可能会发现作业失败了，但甚至连日志都无法查看！这种情况一般是因为内存不足，导致作业被系统强制终止。在极其偶尔的情况下，作业的容器信息也可能丢失。

这时候，你可以查看作业的统计信息，看看作业的内存使用情况。在「我的作业」页面，点击作业名称，切换到统计信息选项卡，可以看到作业的内存使用情况。

![统计信息](./img/monitor.png)

这时，虽然我们无法明确通过日志看到作业失败的原因，但是可以通过内存使用情况推断出作业失败的原因。在这个截图中，可以看到内存使用量达到了 99.7%，说明随后作业被系统强制终止。

## 2. 如何解决作业失败的问题？

### 2.1. 我要怎么知道作业需要多少内存？

您可以先提高内存的申请量，然后根据统计信息中的内存使用情况，逐步调整内存的申请量。
